# 更新日志

CodeBuddy Code 的所有重要更新都会记录在这里。

我们遵循 [语义化版本](https://semver.org/spec/v2.0.0.html) 规范。

## [Unreleased]

## [1.6.0] - 2025-09-30

### 🔧 功能改进
- **文件路径匹配算法重构**：优化文件路径建议功能的匹配算法，提升搜索准确性和性能
- **文件搜索性能优化**：扩展忽略文件列表，减少不必要的文件扫描，提升搜索效率
- **后台任务显示优化**：改进后台任务状态更新机制，从定时刷新改为事件驱动，提升实时性和性能
- **UI交互改进**：优化权限模式显示逻辑，整合到输入提示框中，简化界面布局
- **键盘交互增强**：新增下箭头键查看后台任务功能，改进用户操作体验
- **会话管理优化**：添加后台任务事件通知机制，支持实时状态同步
- **后台任务面板增强**：优化后台任务面板的用户体验，改进快速进入和退出逻辑
- **键盘快捷键文档完善**：扩展快速入门文档中的键盘快捷键说明，新增详细的操作指南
- **上下文处理优化**：改进工具执行时的上下文获取机制，提升执行效率

### 🐛 问题修复
- **工具展示**：修复部分权限模式下工具渲染问题

## [1.5.0] - 2025-09-29

### ✨ 新功能
- **Plan Mode（计划模式）**：新增ExitPlanMode工具，支持在计划模式下完成规划后请求用户确认执行
- **计划模式系统提醒**：新增计划模式专用的系统提醒机制，确保AI在规划阶段不执行修改操作
- **计划模式UI组件**：新增计划模式确认对话框和结果展示组件

### 🔧 功能改进
- **登录界面重构**：优化登录界面组件结构，提升代码可维护性

### 🐛 问题修复
- **MCP服务器审批逻辑**：修复启动时空值检查问题，提升稳定性
- **MCP工具结果渲染**：修复MCP工具结果渲染格式问题
- **工具详情展示**：修复工具详情展示问题
- **UI组件和工具相关修复**：改进多个UI组件和工具功能的稳定性和性能
- **权限模式同步**：修复Task工具中权限模式不同步问题，确保子会话正确继承权限模式
- **UI增强**：新增 MaxHeightBox 和 TextWrapBox 组件，用于控制渲染容器高度和自动换行
- **Diff展示**：将制表符替换为空格防止样式错误
- **输入框**：调整输入框边框样式为单线并隐藏左右边框
- **历史会话**：过滤系统内部消息类型

## [1.4.2] - 2025-09-29

### 🔧 功能改进
- **模型配置优化**：海外版新增 Default 模型

## [1.4.1] - 2025-09-28

### 🔧 功能改进
- **工具参数重写服务**：新增工具参数重写服务，支持动态处理工具调用参数
- **输入组件增强**：优化输入框快捷键处理逻辑，改进背景执行功能支持

### 🐛 问题修复
- **流式输出修复**：修复处理工具调用结果时导致流式输出中断的问题
- **遥测模式修复**：调整遥测数据上报模式设置，确保正确的模式标识

## [1.4.0] - 2025-09-27

### 🐛 问题修复
- **输入框展示**：修改在windows下一些按键或组合键导致输入框异常问题
- **MCP配置管理修复**：修复删除用户级别MCP服务器时误删本地级别服务器配置的问题
- **权限绕过模式修复**：修复权限绕过模式下MCP工具仍需要用户确认的问题

### ✨ 新功能
- **Bashes命令面板**：新增 Bashes 命令面板，支持快捷执行常用脚本
- **MCP配置参数增强**：新增--mcp-config和--strict-mcp-config命令行参数，支持灵活的配置文件指定和严格模式控制

### 🔧 功能改进
- **JSON解析增强**：扩展字符串JSON解析功能，支持多种格式和错误处理
- **提示语优化**：修复MCP命令提示语中的标点符号错误
- **文件路径处理增强**：优化文件列表工具，支持相对路径和绝对路径，提升文件操作灵活性
- **命令命名增强**：优化子目录中自定义命令的命名规则，支持层级结构显示

## [1.3.0] - 2025-09-25

### ✨ 新功能
- **JSON流协议支持**：新增JSON流协议类型，支持实时数据流处理和高效的流式交互
- **流式视图处理**：新增专门的流视图处理组件，优化流式数据的展示和用户体验

### 🔧 功能改进
- **MCP工具权限过滤**：新增基于权限规则的MCP工具过滤机制，支持服务器级和工具级的精确权限控制
- **流协议缓存优化**：移除不必要的缓存参数，提升流处理性能
- **订阅逻辑重构**：精简订阅处理逻辑，改进完成条件判断机制
- **事件源工具**：新增事件源处理工具，增强流式数据处理能力
- **Token使用阈值优化**：调整输入Token使用阈值配置，提升系统性能和用户体验
- **加载框提示**：简化了提示逻辑
- **Help展示当前支持模型**：help命令展示当前模型标识
- **memory支持文件链接**：/memory支持点击链接打开文件
- **mcp提示语修改**：修改没有mcp服务时mcp指令的提示语
- **预编译二进制文件**：内置跨平台 ripgrep 预编译二进制文件，提升首次使用体验和离线可用性
- **模型配置优化**：增强自定义模型配置支持，改进模型回退机制和配置匹配逻辑

## [1.2.1] - 2025-09-25

### 🔧 功能改进
- **自定义代理管理优化**：优化自定义代理管理器的错误处理和文件操作逻辑，提升代理创建和删除的稳定性

## [1.2.0] - 2025-09-24

### ✨ 新功能
- **API 密钥认证支持**：新增 API 密钥认证机制，支持通过环境变量和配置文件设置 API 
- **代理管理界面**：新增完整的代理管理UI界面，支持可视化创建、配置和删除自定义代理
- **智能代理创建**：通过自然语言描述自动生成代理配置，包括系统提示词和使用场景
- **代理配置模板**：新增代理指令生成模板，支持AI辅助创建专业的代理配置

### 🔧 功能改进
- **自定义Agent支持**：新增自定义AgentUI及管理能力
- **代理命令支持**：新增 `/agents` 斜杠命令，支持快速访问代理管理界面
- **代理服务增强**：优化代理服务执行机制，支持上下文隔离和异步执行
- **JSON解析工具**：新增JSON字符串解析工具函数，支持从复杂文本中提取结构化数据
- **CLI 命令别名**：新增 `cbc` 命令别名，等价于 `codebuddy`，提升命令使用便捷性
- **路径解析增强**：支持用户主目录路径（~ 符号）解析，提升文件操作灵活性
- **特殊路径处理**：增强路径解析逻辑，支持特殊前缀路径的智能处理和回退机制
- **编辑工具优化**：改进文本匹配算法，增强字符串匹配的准确性和稳定性
- **模型面板增强**：支持显示 credits、当前模型标记与快捷选择
- **图片处理优化**：改进临时文件清理机制，避免清理非临时图片文件
- **认证系统增强**：优化 HTTP 请求拦截器，支持自动添加 API 密钥到请求头
- **非交互模式重构**：重构非交互模式设置及检测逻辑，采用中间件架构提升代码可维护性

### 🐛 问题修复
- **会话管理优化**：修复会话长度错误提示逻辑，改进上下文截断处理机制
- **响应拦截器改进**：优化模型响应拦截器的执行时机和错误处理

## [1.1.8] - 2025-09-23

### ✨ 新功能
- **配置文件监控**：新增配置文件监控服务，自动监听配置文件变更并同步更新
- **步骤类型处理增强**：新增步骤类型处理机制，支持最终输出和中断状态的智能识别
- **中断原因提示优化**：增强中断处理提示，提供详细的中断原因和权限绕过指引

### 🔧 功能改进
- **代理管理架构重构**：重构代理管理系统，将业务逻辑从UI组件迁移至服务层，提升代码可维护性和系统稳定性
- **代理管理优化**：优化代理删除操作，提升删除性能和数据同步机制
- **文件监控优化**：增强文件监控机制，支持防抖处理和错误恢复
- **编辑工具优化**：改进文本匹配算法，增强多行文本搜索的准确性和稳定性

### 🐛 问题修复
- **图像路径解析优化**：改进图像路径解析器对包含空格和引号的文件路径处理，提升拖拽图片功能稳定性
- **系统提醒格式修复**：修复系统提醒消息的格式问题，确保正确的标签闭合

## [1.1.7] - 2025-09-23

### 🔧 功能改进
- **会话管理优化**：移除getMostRecent方法中的冗余handleRunResult调用，提升会话获取性能和稳定性

## [1.1.6] - 2025-09-22

### ✨ 新功能
- **图像拖拽支持**：新增图像文件拖拽识别和处理功能，支持自动检测图像文件路径
- **文件路径引用**：支持通过 @filepath 语法引用文件，自动读取并处理图像和文本文件
- **增强输入解析**：新增输入解析系统，支持扩展的输入处理能力
- **子代理颜色标识**：新增子代理颜色支持，支持在配置中自定义颜色或自动生成一致的颜色标识
- **界面视觉增强**：子代理消息和工具调用现在会显示带颜色背景的代理名称标识，提升界面可读性

### 🔧 功能改进
- **输入体验增强**：改进文本输入组件，支持增强输入事件处理
- **图像处理优化**：支持临时和非临时图像文件的统一处理机制
- **文件类型检测**：增强文件类型识别能力，支持更多图像和文本格式
- **工具配置优化**：调整工具列表顺序，将Task工具提升至列表顶部，优化工具调用优先级
- **权限管理增强**：改进MCP服务器权限检查机制，支持绕过权限模式和更精细的权限控制
- **自定义请求头支持**：新增环境变量和配置支持，允许为 API 请求添加自定义 HTTP 头
- **UI渲染优化**：优化工具调用结果的高度计算和渲染逻辑，提升界面显示效果
- **启动流程重构**：改进应用启动状态管理，采用步骤化处理提升启动体验
- **界面显示增强**：统一使用图标替代emoji，改进提示信息显示样式

## [1.1.5] - 2025-09-21

### 🔧 功能改进
- **Agent名称优化**：将"task"代理重命名为"general-purpose"代理，提供更清晰的功能描述
- **兼容性增强**：改进machineId获取机制，添加Termux等受限环境的错误处理和备用方案

## [1.1.4] - 2025-09-20

### ✨ 新功能
- **权限管理命令**：新增 `/permissions` 斜杠命令，支持快速访问权限管理界面

### 🔧 功能改进
- **加载界面增强**：新增智能提示组件，在加载过程中显示使用技巧和计费信息
- **会话管理优化**：增强会话恢复功能，改进消息流处理和状态管理
- **权限界面优化**：改进权限管理面板的UI样式和用户体验，提升布局和交互体验
- **导出功能增强**：改进文件导出功能，支持可点击的文件路径超链接
- **操作反馈增强**：增加权限规则操作的状态反馈机制
- **修复序列化**：修复持久化时序列化异常
- **MCP服务缓存修复**：修复MCP服务缓存重复添加问题，提升服务连接稳定性

### 🔒 安全增强
- **命令安全检查**：新增命令安全验证机制，支持危险命令检测和风险提示
- **工具权限加固**：增强工具调用权限验证，添加静态安全规则检查
- **用户确认界面**：优化工具确认对话框，增加安全风险警告提示

## [1.1.3] - 2025-09-19

### 🔧 功能改进
- **read工具修复**：修复read工具流式读取异常

## [1.1.2] - 2025-09-18

### 🔧 功能改进
- **bash工具修复**：修复bash工具输出异常

## [1.1.1] - 2025-09-18

### ✨ 新功能
- **权限管理面板**：新增完整的权限管理UI界面，支持可视化配置Allow/Ask/Deny/Workspace四种权限类型
- **Ask权限类型**：新增Ask权限配置，支持工具使用前询问用户确认
- **工作区目录管理**：增强目录选择器功能，支持工作区目录的添加和移除操作
- **记忆管理命令**：新增 `/memory` 斜杠命令，支持快速访问和管理项目及用户级记忆文件
- **文件打开功能**：增强文件操作工具，支持跨平台文件打开功能
- **记忆界面优化**：完善记忆保存菜单，支持命令模式和交互模式双重操作方式

### 🔧 功能改进
- **权限配置系统重构**：重构权限数据管理器，支持多作用域权限规则管理
- **目录验证逻辑优化**：提取目录验证工具类，提升代码复用性和维护性
- **UI组件增强**：优化面板容器组件，支持自定义边框颜色和提示文本
- **路径解析增强**：支持用户主目录路径（~ 符号）解析，提升文件操作灵活性
- **命令执行优化**：优化内存命令执行器，支持无参数调用时自动进入管理界面

## [1.1.0] - 2025-09-18

### ✨ 新功能
- **MCP服务器审批机制**：为项目作用域的MCP服务器添加安全审批功能，用户可通过UI界面确认批准服务器连接
- **权限模式动态管理**：实现会话级权限模式动态切换，支持运行时权限状态更新和UI显示
- **流式渲染增强**：实现bash工具流式消息渲染，支持实时输出显示
- **后台任务管理**：新增后台工具任务管理功能，支持任务状态跟踪和控制
- **键盘服务扩展**：新增键盘服务模块，提供更丰富的交互控制能力
- **新增命令**：添加resume、add-dir、doctor命令
- **错误文案优化**：使用更友好的文案进行错误展示

### 🔧 功能改进
- **跨平台按键处理增强**：改进特殊按键处理机制，提升不同平台下的输入体验
- **bash工具重构**：优化bash命令执行流程，改为流式渲染模式，提升用户体验
- **UI组件增强**：新增流式工具调用渲染组件和高度限制容器组件
- **消息分组优化**：改进消息分组逻辑，更好地处理流式数据显示
- **命令选项修复**：修复命令行选项默认值配置问题
- **路由系统优化**：修复路由组件接口兼容性问题，统一组件props规范

## [1.0.19] - 2025-09-16

### 🔧 功能改进
- **HTTP操作重构**：优化CLI调度器中的HTTP操作依赖注入方式，使用RestOperationsFactory创建实例
- **代理配置增强**：为HTTP请求添加代理配置支持，提升网络请求灵活性

## [1.0.18] - 2025-09-16

### 🔧 功能改进
- **路径工具重构**：优化设置文件路径解析逻辑，统一使用项目主目录方法
- **文档完善**：更新设置文档，校正配置作用域和CLI示例

## [1.0.17] - 2025-09-15

### 🔧 功能改进
- **上下文压缩优化**：增强上下文压缩后的连续对话功能，自动提示AI基于总结内容继续对话
- **中断服务增强**：优化工具调用中断处理，添加延时机制提升稳定性

## [1.0.16] - 2025-09-15

### 🔧 功能改进
- **路径工具增强**：新增 `getProjectHomeDir()` 方法，提供更精确的项目级配置目录管理
- **目录信任优化**：重构设置文件读取逻辑，使用相对路径显示，提升用户体验

## [1.0.15] - 2025-09-15

### ✨ 新功能
- **目录信任机制**：添加是否信任目录的逻辑，区分危险和普通目录，支持配置信任目录列表

### 🐛 问题修复
- **登录体验优化**：修复登录切换时没有清除 logo 的问题，修复取消后无法登录的问题

## [1.0.14] - 2025-09-15

### ✨ 新功能
- **📊 遥测状态报告**：新增周期性和启动时的插件状态事件遥测功能，提升产品监控能力

### 🐛 问题修复
- **错误提示优化**：改进模型响应异常时的用户提示信息，提供更友好的错误处理体验

## [1.0.13] - 2025-09-15

### 🔧 功能改进
- **模型配置优化**：提升模型输出token限制，增强处理能力

## [1.0.12] - 2025-09-14

### ✨ 新功能
- **🔐 权限模式增强**：新增 `--permission-mode` 命令行选项，支持多种权限控制模式
- **🖥️ Windows 兼容性检查**：增强Windows环境下的Git Bash检测和提示
- **🚀 升级命令**：新增 `/upgrade` 命令，支持在浏览器中打开升级页面，包含完整的升级信息展示界面

### 🔧 功能改进
- **📋 MR 命令优化**：优化MR创建流程，添加文档检查步骤，简化命令模板
- **🛠️ 工具权限逻辑**：改进工具权限检查机制，统一权限处理逻辑
- **🚀 同步脚本优化**：优化开源仓库同步脚本，增加文件内容差异检查，提升同步效率
- **⚡ Agent拦截器优化**：重构拦截器优先级顺序，使用依赖注入Provider优化性能
- **🔄 消息历史管理**：优化消息队列处理逻辑
- **💾 Token管理优化**：实现模型请求token超限后自动裁剪历史消息功能
- **📝 帮助文本优化**：优化帮助文本解析逻辑，仅取首行非空内容，提升显示效果

### 📖 文档更新
- **📚 CLI参考文档**：更新CLI参考文档，添加 `--permission-mode` 选项说明

## [1.0.11] - 2025-09-12

### 🔧 功能改进
- **📋 命令管理优化**：改进命令管理器的合并和去重逻辑，提升命令系统的稳定性和性能
- **🎨 界面代码优化**：移除不必要的 Suspense 组件，简化 UI 渲染逻辑，提升界面响应速度
- **🔧 代码质量提升**：优化多个 UI 组件的实现，清理冗余代码，提升代码可维护性

### 🐛 问题修复
- **⌨️ 输入历史体验修复**：修复上下箭头浏览历史时清空当前输入内容的问题，现在可以安全地浏览历史记录而不丢失正在编辑的内容
- **🔍 环境检测修复**：修复环境检测器的相关问题，提升系统兼容性
- **🛠️ 工具系统优化**：优化基础工具类和 Web 获取工具的实现，提升工具执行稳定性
- **🛠️ CA 证书问题导致无法登录**：改进 SSL 配置，支持系统证书+自定义证书

## [1.0.10] - 2025-09-11

### ✨ 新功能
- **🤖 DeepSeek-V3.1 模型支持**：新增对 DeepSeek-V3.1 模型的支持，提供更强大的推理能力
- **🔄 Resume 切换逻辑**：添加 resume 切换逻辑初版，支持会话恢复和上下文切换功能
- **⚙️ CodeBuddy 配置支持**：新增 .codebuddy 目录配置支持，提供更灵活的项目级配置管理

### 🔧 功能改进
- **🎨 界面优化**：修改 summary 获取逻辑和样式，提升用户界面体验
- **📖 文档格式优化**：改进自定义命令和斜杠命令文档格式，统一 shell 命令语法规范

### 🐛 问题修复
- **🔌 MCP 修复**：修复 MCP 创建逻辑及 listTools 方法异常处理，提升 Model Context Protocol 稳定性

## [1.0.9] - 2025-09-10

### ✨ 新功能
- **🤖 O4-Mini 模型支持**：新增对 O4-Mini 模型的支持，提供更多模型选择
- **📚 帮助文档链接**：添加官方帮助文档链接，方便用户查阅使用指南
- **⚡ 自定义命令增强**：支持自定义命令中的行内 bash 命令执行

### 🔧 功能改进
- **管道输入优化**：改进管道输入检测机制，添加超时处理避免在输出管道时无限等待
- **命令建议增强**：移除命令建议数量限制，显示所有匹配的命令选项
- **帮助面板优化**：动态加载命令列表，提升帮助面板的实时性和准确性

### 🐛 问题修复
- **登录流程优化**：修复 /login 后没有刷新页面的逻辑问题
- **快捷键修复**：修改组合快捷键导致输入框不正常的问题
- **管道处理稳定性**：修复管道输入读取时的异常处理，提升命令行稳定性

### 📖 文档更新
- **MCP 文档完善**：补充 MCP 服务器优先级、参数及多语言支持等说明

## [1.0.8] - 2025-09-10

### ✨ 新功能
- **🚀 GPT5 支持**：新增对 GPT5 模型的完整支持，提供更强大的推理能力
- **🔌 MCP 协议增强**：优化 Model Context Protocol 集成，支持 HTTP 和 SSE 传输协议，新增 OAuth2 认证支持，提供更灵活的外部工具集成
- **⚡ 自定义斜杠命令**：新增自定义斜杠命令功能，用户可根据需要扩展 CLI 功能
- **📝 日志持久化**：增加日志持久化功能，便于问题排查和调试

### 🔧 功能改进
- **Windows 兼容性**：优化 Windows 平台下的快捷键体验
- **认证体验**：改进服务器认证逻辑，提升登录稳定性
- **文件搜索**：优化文件搜索功能，修复重复搜索问题

### 🐛 问题修复
- **MCP 连接**：修复 MCP 服务器连接状态检测问题
- **登录流程**：修复登录页面重复跳转问题，改善用户体验

## [1.0.7] - 2025-09-08

### ✨ 新功能
- **模型上下文初始化**：新增模型上下文初始化功能，提升AI对话体验

### 🔧 技术改进
- **代码优化**：优化了部分代码逻辑，提升系统性能

### 🐛 问题修复
- **登录状态修复**：修复在登陆状态执行完logout后esc会跳转至登陆页问题
- **消息清除修复**：修复切换login时没有清除消息问题

## [1.0.6] - 2025-09-08

### ✨ 新功能
- **管道输入支持**：新增管道输入功能，支持 `cat package.json | codebuddy -p "分析下组件依赖了哪些"` 语法
- **内容智能组合**：管道内容与用户提示自然组合，管道内容在前，用户指令在后
- **兼容性保持**：完全兼容现有的交互和非交互模式，不影响原有功能

### 🔧 技术改进
- **输入检测**：通过 `process.stdin.isTTY` 自动检测管道输入
- **异步处理**：优化管道数据读取的异步处理逻辑

## [1.0.5] - 2025-09-07

### 🔧 功能改进
- **错误处理增强**：完善消息处理的边缘情况处理，提升系统鲁棒性

## [1.0.4] - 2025-09-07

### 🐛 问题修复
- **配置问题**：修复模型上下文水位配置参数

### ✨ 新功能
- **模型支持**：国内版添加 Default 模型

## [1.0.3] - 2025-09-06

### 🐛 问题修复
- **系统稳定性**：修复多项系统稳定性问题，提升整体可靠性
- **工具执行优化**：改进工具执行流程，解决边缘情况处理

## [1.0.2] - 2025-09-06

### 🐛 问题修复
- **消息展示优化**：添加粘贴大段文字展示压缩消息的逻辑，改善用户体验
- **命令执行修复**：修复 add-dir 在 tab 模式下出现丢失命令的情况
- **工具执行优化**：修复取消工具执行时的上报问题，改进异常处理机制

### ✨ 新功能
- **输入 Token 水位提示**：增加输入 token 水位提示功能，帮助用户控制输入长度

### 🔧 功能改进
- **外链配置抽离**：将外链抽离到配置中，提升配置管理灵活性
、
## [1.0.0] - 2025-09-05

### 🎉 正式版发布
- **里程碑版本**：CodeBuddy Code 正式发布 1.0.0 版本，标志着产品进入稳定阶段
- **功能完善**：经过多个 beta 版本的迭代，核心功能已趋于稳定和成熟

### 🐛 问题修复
- **请求头修复**：修复请求头 conversation-request-id 错误问题，提升 API 调用准确性
- **工具执行优化**：修复取消工具执行时的上报问题，改进异常处理机制
- **Grep 工具稳定性**：解决 grep 工具卡住问题，提升搜索体验

### ✨ 新功能
- **多文件选择**：选择文件支持多文件操作，优化排序方式为 fuzzy-match 算法
- **目录管理增强**：实现 add-dir 指令的展示和选择后逻辑处理

### 🔧 功能改进
- **诊断工具增强**：doctor 增加账号环境信息显示
- **性能监控**：cost 服务增加 API 调用耗时统计
- **使用统计**：统计程序启动后的模型消耗和文件变化数据

### 🏗️ 架构优化
- **代码质量提升**：经过多轮重构和优化，代码架构更加稳定
- **依赖管理**：优化依赖关系，提升应用启动和运行性能
- **错误处理**：完善错误处理机制，提升用户体验

## [0.0.1-beta.32] - 2025-09-04

### 🐛 问题修复
- **Agent 管理优化**：修复登出和重建 Agent 时的异常处理，提升系统稳定性
- **环境切换修复**：解决切换内外网账号后模型配置匹配失败问题

### ✨ 新功能
- **使用统计监控**：新增模型消耗、token 使用量和文件变化的实时统计功能
- **灵活认证方式**：支持通过环境变量或自定义脚本获取 API 密钥，提升集成便利性

### 🔧 架构优化
- **Agent 状态管理**：重构登出流程，移除冗余监听器，简化状态管理逻辑
- **认证服务重构**：优化环境认证提供器，支持多环境无缝切换
- **成本服务集成**：新增 CostService 和相关协议，实现完整的使用量监控体系
- **遥测功能增强**：扩展遥测服务，集成成本统计和性能监控
- **产品环境管理**：优化环境配置动态更新机制

## [0.0.1-beta.31] - 2025-09-03

### 🐛 问题修复
- **输入体验优化**：修复在 Neovim 等编辑器中的输入问题，解决多行文本丢失和字符截断
- **登录流程改进**：修复登录地址跳转异常，确保认证流程正常运行

### ✨ 功能改进
- **终端兼容性增强**：改进对复杂终端环境的适配，提升输入稳定性

## [0.0.1-beta.30] - 2025-09-02

### 🐛 问题修复
- **界面显示优化**：修复多工具并行执行时的界面显示问题
- **文本输入改进**：解决多行文本粘贴丢失和参数解析异常
- **消息追踪修复**：改进消息ID上报机制，确保统计准确性
- **导航优化**：清理多余的路由跳转逻辑，提升交互流畅性

### ✨ 新功能
- **Jupyter 笔记本支持**：新增 NotebookWrite 工具，支持创建和编辑笔记本文件
- **多区域登录**：支持国内外不同账号登录，适配全球用户需求
- **MCP 服务器管理**：增强服务器连接状态显示和异步重连功能

### 🔧 功能改进
- **命令显示优化**：改进命令执行结果的渲染效果
- **状态管理优化**：统一属性命名规范，提升代码一致性

## [0.0.29] - 2025-09-01

### 🔧 性能优化
- **消息处理优化**：简化消息ID生成机制，提升处理性能
- **算法改进**：重构消息查找算法，提升查找准确性和速度

## [0.0.1-beta.28] - 2025-09-01

### 🐛 问题修复
- **界面优化**：修复工具详情页参数展示样式问题
- **连接稳定性**：解决 MCP 连接配置缺失导致的连接失败

### ✨ 新功能
- **自定义 Header**：支持自定义 HTTP header 配置，提升 API 请求灵活性
- **MCP 服务器管理**：增强连接状态显示和异步重连功能
- **IDE 集成优化**：在模型请求中添加 IDE 信息，便于调试

### 🔧 功能改进
- **消息追踪优化**：改进消息ID生成机制，提升统计准确性

## [0.0.1-beta.27] - 2025-08-29

### 🐛 问题修复
- **任务执行优化**：改进任务工具的会话控制和计时器逻辑
- **会话管理改进**：优化面板退出时的会话处理，确保状态正确维护
- **历史记录修复**：解决空字符串处理异常问题

### ✨ 新功能
- **MCP 协议支持**：新增 Model Context Protocol 配置管理功能
- **DeepSeek v3.1**：支持最新的 DeepSeek v3.1 模型
- **配置文件增强**：CODEBUDDY.md 支持 @ 语法嵌套引用其他文件

### 🚀 性能提升
- **上下文处理**：模型输入 token 限制提升至 128k，支持更大规模对话
- **模型配置**：重构配置拦截器，支持更灵活的参数设置

## [0.0.1-beta.26] - 2025-08-27

### ✨ 重大更新
- **任务工具**：新增 TaskTool 工具，支持独立会话执行复杂任务
- **消息队列管理**：新增消息队列管理器，提供更好的任务状态管理
- **中断处理**：新增中断服务，支持工具调用审批和中断处理

### 🔧 架构优化
- **代理系统**：优化代理拦截器，增强输入处理和状态管理
- **会话管理**：改进会话管理器，添加函数调用结果处理
- **UI 简化**：精简 UI 架构，移除冗余代码

### 🐛 问题修复
- **任务执行**：修复任务工具的中断处理和资源清理问题
- **用户交互**：优化工具调用审批和确认对话框体验

## [0.0.1-beta.25] - 2025-08-25

### 🔧 界面优化
- **状态显示简化**：移除呼吸灯动画，统一使用静态图标，提升性能

### 🐛 稳定性修复
- **Agent 状态管理**：修复空指针异常，提升状态更新安全性

## [0.0.1-beta.24] - 2025-08-25

### ✨ 新功能
- **MCP 协议完善**：完善 Model Context Protocol 支持，新增 `/mcp` 指令
- **文件操作增强**：读写工具支持相对/绝对路径，提升操作灵活性
- **输出优化**：添加标准输出截断功能，防止超长输出影响性能
- **工具确认优化**：改进工具确认对话框，支持拒绝和继续流程

### 🔧 功能改进
- **界面交互**：优化 ESC 退出逻辑，提升用户体验
- **工具渲染**：重构工具调用渲染系统，规范组件属性
- **设置集成**：支持动态工具描述模板渲染
- **提交流程**：默认关闭 Co-Authored-By 功能，简化操作

### 🐛 问题修复
- **命令处理**：解决子命令参数冲突问题
- **状态管理**：修复工具调用状态处理和会话管理逻辑
- **界面显示**：修复 diff 替换错误和界面渲染问题
- **类型安全**：统一接口命名，修复拼写错误

## [0.0.1-beta.23] - 2025-08-22

### ✨ 界面增强
- **呼吸灯动画**：新增工具执行状态的动态视觉反馈
- **生命周期管理**：添加应用优雅关闭和资源清理功能

### 🔧 组件优化
- **LoadingBox 重构**：采用组合式架构，提升可维护性
- **状态显示优化**：根据工具执行状态动态调整显示格式
- **动画流畅度**：提升终端界面动画体验

### 🐛 稳定性修复
- **内存管理**：修复应用退出时的资源清理问题
- **状态管理**：优化组件状态管理和渲染逻辑

## [0.0.1-beta.22] - 2025-08-22

### ✨ 重大功能
- **自动更新系统**：新增完整的自动更新服务，支持后台检查和用户通知
- **更新偏好设置**：用户可自定义更新偏好，控制更新行为

### 🔧 系统优化
- **通知系统重构**：统一更新通知管理，简化显示格式
- **上下文优化**：调整 token 阈值，提高上下文压缩触发频率
- **配置管理**：集中管理配置常量，提升可维护性

### 🐛 关键修复
- **订阅问题**：修复更新通知订阅只执行一次的问题
- **内存泄漏**：解决订阅生命周期管理导致的内存问题
- **渲染循环**：修复无限渲染循环问题

## [0.0.1-beta.21] - 2025-08-21

### ✨ 新功能
- **MCP 协议支持**：新增 Model Context Protocol 模块，支持服务器配置管理
- **命令界面**：添加指令对应面板，提升交互体验
- **输出优化**：添加输出截断功能，防止超长输出影响性能

### 🔧 功能改进
- **跨平台体验**：改进剪贴板兼容性检查和 Agent 状态管理
- **界面优化**：优化窄终端下的显示效果，改进 diff 颜色显示
- **代码编辑**：增强编辑工具验证逻辑，提高准确性和安全性

### 🐛 关键修复
- **内存泄漏**：修复搜索中止时的内存泄漏问题，提升应用稳定性
- **文本处理**：修复 diff 文本替换错误，改进处理准确性
- **状态管理**：修复会话状态判断逻辑，添加缺失的 React key 属性

## [0.0.1-beta.20] - 2025-08-21

### ✨ 跨平台增强
- **剪贴板兼容性**：新增 macOS/Windows/Linux 三大平台剪贴板兼容性检查
- **错误处理优化**：新增友好的错误提示和安装指引
- **后备方案**：为 macOS 添加 osascript 作为 pngpaste 的后备方案

### 📊 性能优化
- **输出截断**：添加输出截断功能，防止超长输出影响性能
- **内存管理**：优化上下文管理，分离用户和项目内存

### 🐛 重大修复
- **界面稳定性**：修复终端界面闪动问题，极大提升用户体验
- **显示优化**：修复窄终端下的边框显示和 diff 颜色问题
- **状态管理**：重构 Agent 状态管理，优化事件处理机制

## [0.0.1-beta.19] - 2025-08-21

### Added
- 实现连续用户消息自动合并功能，确保不会有连续一个以上的 user message 发送给 AI
- 新增 useAgentState hook，提供响应式的 Agent 状态管理
- 在 Session 接口中添加 agentStateSubject，支持状态变化的实时通知
- 支持 string 和数组两种 content 类型的消息合并，兼容多媒体内容

### Changed
- 将 agentState 从 SessionContext 迁移到 ConversationContext，职责分离更清晰
- LoadingBox 现在能实时响应 agentState 变化，提升用户体验
- 优化工具确认对话框第3选项文本：从 "No, and tell CodeBuddy what to do differently" 改为 "No, reject this tool and continue"
- 统一 inConversation 逻辑判断，使用 useContextSelector 精确订阅状态

### Fixed
- 修复 LoadingBox 无法感知 agentState 变化的问题
- 改进消息合并逻辑，在不同消息间添加分隔符以区分原始内容
- 优化 AgentStateAgentRunInterceptor，同时更新 agentState 和 agentStateSubject

### Technical Details
- mergeConsecutiveUserMessages: 新增连续用户消息合并函数
- mergeUserMessages: 支持多种 content 格式的消息合并
- AgentStateAgentRunInterceptor: 增强状态更新机制，支持响应式通知
- SessionFactory: 初始化 agentStateSubject 用于状态监听
- ConversationContext: 集中管理对话相关状态，包括 agentState
- ConfirmBox: 优化工具确认选项文本，更符合实际业务功能

## [0.0.1-beta.18] - 2025-08-20

### Added
- 实现基于 Ctrl+V 的图片粘贴功能，支持跨平台图片剪贴板检测（macOS/Windows/Linux）
- 新增图片占位符系统 `[Image #N]`，支持多图片粘贴和自动编号
- 集成 InputState 提示系统，当剪贴板无图片时显示友好提示
- 支持图片占位符删除时自动清理对应临时文件
- 消息发送时保留图片占位符文本，同时发送图片数据给 AI 模型

### Changed
- 提高 Agent 默认最大执行轮次从 20 提升到 100
- 抽象化 Agent 执行常量，统一管理在 agent-protocol.ts 中
- 优化图片粘贴检测机制，使用事件驱动替代定时轮询
- 每轮对话结束后自动重置图片索引计数器

### Technical Details
- ClipboardUtils: 新增跨平台剪贴板工具类，支持 macOS(pngpaste)、Windows(PowerShell)、Linux(xclip)
- InputItemUtils: 扩展支持多图片消息创建，保留原始文本中的占位符
- InkTextInput: 增强 Ctrl+V 事件捕获，支持图片粘贴检测
- InputHintBox: 新增 NO_IMAGE_HINT 状态和对应提示组件
- Agent Protocol: 新增 DEFAULT_MAX_TURNS = 100 常量定义

## [0.0.1-beta.17] - 2025-08-19

### Added
- 重构并增强 web-fetch 工具功能，支持更复杂的内容处理
- 新增 web-search 工具，支持搜索引擎集成
- 新增 notebook-edit 工具，增强 Jupyter Notebook 编辑功能
- 新增内容分析器代理指令模板
- 为确认对话框选项添加箭头指示符，提升用户界面可用性和直观性

### Changed
- 简化 web-fetch-tool 和 web-search-tool 的渲染器配置
- 重构 use-conversation-state 钩子，改进中断处理逻辑
- 优化回调函数的依赖项和清理逻辑

### Fixed
- 优化文件排除逻辑并改进通配符转正则表达式处理

### Technical Details
- ConfirmBox: 为选中的选项添加 '> ' 前缀，为未选中的选项添加 '  ' 前缀保持对齐
- WebSearchTool: 移除未使用的权限检查逻辑，添加别名支持
- WebFetchTool: 重构架构，增强内容处理能力
- NotebookEditTool: 全新实现，支持完整的 Jupyter Notebook 编辑操作

## [0.0.1-beta.16] - 2025-08-19

### Added
- 新增流式响应支持，ModelProvider 现在可以正确处理 Server-Sent Events 流式数据
- 基于工具调用结果内容长度的 token 计算优化
- 支持工具并行执行

### Changed
- 优化 token 显示逻辑，统一展示格式（优先显示输出 token，否则显示输入 token）
- 改进错误处理机制，根据 result.newItems 最后一项类型智能选择返回的消息类型

### Fixed
- 修复 axiosToFetchAdapter 方法对流式响应的处理问题
- 修复输入框内存状态检查顺序问题
- 修复 useTokenTracking hook 中 turnInputTokens 计算逻辑
- 修复 Connect Error 问题
- 修复 memory 模型无法回车问题

### Technical Details
- ModelProvider: 添加流式请求检测和 ReadableStream 创建
- TokenTracking: 使用 function_call_result 内容字符数计算输入 token
- ConversationState: 智能消息类型选择和历史补偿机制
- LoadingBox: 简化 token 信息展示，移除条件判断

## [0.0.1-beta.15] - 2025-08-19

### Added
- 新增版本发布和分支管理功能
- 改进输入框组件的用户体验

### Changed
- 更新版本号到 0.0.1-beta.15
- 优化输入建议菜单的交互逻辑

### Fixed
- 修复输入框相关的UI问题

## [0.0.1-beta.14] - 2025-08-18

### ✨ 功能增强
- **命令优化**：优化斜杠命令拦截器和 token 跟踪显示
- **文本输入改进**：增强多行编辑、自动补全和快捷键导航
- **消息队列**：添加待发送消息队列显示功能
- **加载体验**：增加更友好的 loading 提示

### 🐛 问题修复
- **显示优化**：修复 todo 完成颜色和代码展示问题
- **编码问题**：修复 Windows bash 中文乱码
- **工具渲染**：改进工具展开和显示逻辑

### 🔧 架构改进
- **工具系统重构**：调整参数结构和提示模板
- **依赖更新**：更新核心依赖到最新版本

## [0.0.1-beta.11] - 2025-08-14

### ✨ 新功能
- **历史记录**：添加输入历史记录，支持上下键导航和本地存储
- **环境变量**：支持设置中的环境变量应用到对话
- **界面稳定性**：使用静态组件修复终端闪烁问题

### 🐛 问题修复
- **显示优化**：修复错误刷新逻辑、回复样式和重复展示问题
- **界面调整**：优化 hint 边距和会话 margin
- **工具渲染**：解决工具不渲染和 bash 模式展开问题
- **文本处理**：修复多行文本展示和光标位置
- **页面闪烁**：修复登录页面和工具详情显示问题

### 🔧 架构优化
- **状态管理**：重构菜单状态管理，统一使用 InputState.MENU
- **命名规范**：统一文件编辑工具参数命名为 snake_case 风格

## [0.0.1-beta.10] - 2025-08-13 及之前

### 🎉 初始版本
- **核心功能**：实现基础 agent-cli 功能
- **工具系统**：搭建完整的工具系统架构
- **会话管理**：实现基础会话管理功能
- **CLI 界面**：构建基础命令行界面

### 🏗️ 架构建立
- **初始设计**：完成初始架构设计和基础实现

---

## 📋 版本说明

本更新日志记录了 CodeBuddy Code 的所有重要功能更新和问题修复。我们持续改进产品体验，为开发者提供更好的 AI 编程助手。

如有问题或建议，请访问 [Issues 页面](https://cnb.cool/codebuddy/codebuddy-code/-/issues) 反馈。
